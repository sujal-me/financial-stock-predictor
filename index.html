<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarketMind AI Terminal</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Icons (Phosphor) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Chart.js (Optional for future, but we'll build custom CSS bars for now for speed/simplicity) -->

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        gray: {
                            850: '#1f2937',
                            900: '#111827',
                            950: '#030712',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0f172a; /* Slate 950 */
            color: #e2e8f0;
        }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .prediction-up {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(6, 78, 59, 0.2) 100%);
            border-color: rgba(16, 185, 129, 0.3);
            color: #34d399;
        }

        .prediction-down {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(127, 29, 29, 0.2) 100%);
            border-color: rgba(239, 68, 68, 0.3);
            color: #f87171;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col antialiased">

    <!-- Navbar -->
    <nav class="border-b border-slate-800 bg-slate-900/80 sticky top-0 z-50 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded bg-indigo-600 flex items-center justify-center text-white shadow-lg shadow-indigo-500/30">
                        <i class="ph ph-trend-up text-xl"></i>
                    </div>
                    <span class="text-lg font-bold tracking-tight text-white">MarketMind<span class="text-indigo-400">AI</span></span>
                </div>
                <div class="flex items-center gap-4">
                    <div class="hidden md:flex items-center gap-2 text-xs text-slate-400 bg-slate-800 px-3 py-1.5 rounded-full border border-slate-700">
                        <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                        System Operational
                    </div>
                    <button id="toggleSettings" class="text-slate-400 hover:text-white transition-colors">
                        <i class="ph ph-gear text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto w-full space-y-6">

        <!-- Settings Panel (Hidden by default) -->
        <div id="settingsPanel" class="hidden glass-panel rounded-xl p-4 mb-6 border-l-4 border-indigo-500">
            <h3 class="text-sm font-semibold text-slate-300 uppercase tracking-wider mb-2">Configuration</h3>
            <label class="block text-xs text-slate-400 mb-1">Gradio API URL</label>
            <div class="flex gap-2">
                <input type="text" id="apiUrlInput" value="https://nimjesss-financial-news-predictor.hf.space" 
                    class="flex-1 bg-slate-950 border border-slate-700 rounded px-3 py-2 text-sm focus:outline-none focus:border-indigo-500 text-slate-200 font-mono">
            </div>
            <p class="text-xs text-slate-500 mt-2">Gradio live links expire every 72 hours. Update above if requests fail.</p>
        </div>

        <!-- Input Section -->
        <section class="glass-panel rounded-2xl p-1">
            <div class="relative group">
                <textarea id="newsInput" rows="3" 
                    class="w-full bg-transparent border-none text-slate-200 placeholder-slate-500 p-4 focus:ring-0 text-lg resize-none"
                    placeholder="Enter financial news, earnings reports, or market headlines here for analysis..."></textarea>
                <div class="absolute bottom-2 right-2 flex gap-2">
                    <button id="clearBtn" class="px-3 py-1.5 text-xs font-medium text-slate-400 hover:text-white hover:bg-slate-800 rounded transition-colors">
                        Clear
                    </button>
                    <button id="analyzeBtn" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-1.5 rounded-lg text-sm font-medium shadow-lg shadow-indigo-600/20 transition-all flex items-center gap-2">
                        <i class="ph ph-lightning"></i> Analyze
                    </button>
                </div>
            </div>
        </section>

        <!-- Loading State -->
        <div id="loadingState" class="hidden py-12 text-center">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mb-4"></div>
            <p class="text-slate-400 animate-pulse">Processing market data models...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden glass-panel border-red-500/30 bg-red-500/10 p-4 rounded-xl text-red-200 flex items-center gap-3">
            <i class="ph ph-warning-circle text-xl"></i>
            <span id="errorMessage">An error occurred.</span>
        </div>

        <!-- Results Dashboard -->
        <div id="resultsDashboard" class="hidden space-y-6 animate-fade-in">
            
            <!-- Top Row: Prediction & Consensus -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Main Prediction Card -->
                <div id="predCard" class="glass-panel rounded-xl p-6 flex flex-col items-center justify-center text-center relative overflow-hidden md:col-span-1">
                    <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/graphy.png')]"></div>
                    <h3 class="text-sm font-medium text-slate-400 uppercase tracking-widest mb-4 z-10">Market Direction</h3>
                    <div id="predIcon" class="text-6xl mb-2 z-10 transform transition-transform hover:scale-110">
                        <!-- Icon injected by JS -->
                    </div>
                    <div id="predText" class="text-4xl font-black tracking-tighter z-10 mb-1">
                        <!-- UP/DOWN -->
                    </div>
                    <div id="predConfidence" class="text-sm font-mono opacity-80 z-10 bg-slate-900/50 px-3 py-1 rounded-full">
                        <!-- Confidence -->
                    </div>
                </div>

                <!-- Model Ensemble -->
                <div class="glass-panel rounded-xl p-6 md:col-span-2 flex flex-col justify-center">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-sm font-medium text-slate-400 uppercase flex items-center gap-2">
                            <i class="ph ph-brain text-indigo-400"></i> Model Consensus
                        </h3>
                        <span class="text-xs text-slate-500 bg-slate-800 px-2 py-1 rounded">Ensemble Logic</span>
                    </div>
                    
                    <div id="ensembleContainer" class="space-y-4">
                        <!-- Bars injected by JS -->
                    </div>
                </div>
            </div>

            <!-- Middle Row: Market Data Grid & Sentiment -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- Financial Metrics -->
                <div class="glass-panel rounded-xl p-6 lg:col-span-2">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-medium text-slate-400 uppercase flex items-center gap-2">
                            <i class="ph ph-chart-line-up text-blue-400"></i> Technical Indicators
                        </h3>
                        <span id="analysisDate" class="text-xs font-mono text-slate-500"></span>
                    </div>
                    <div id="marketGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Metrics injected by JS -->
                    </div>
                </div>

                <!-- Sentiment Analysis -->
                <div class="glass-panel rounded-xl p-6">
                    <h3 class="text-sm font-medium text-slate-400 uppercase flex items-center gap-2 mb-4">
                        <i class="ph ph-smiley text-yellow-400"></i> Sentiment
                    </h3>
                    <div id="sentimentContainer" class="flex flex-col items-center justify-center h-full py-4 space-y-4">
                        <!-- Sentiment gauge injected by JS -->
                    </div>
                </div>
            </div>

            <!-- Bottom Row: Summaries -->
            <div class="glass-panel rounded-xl overflow-hidden flex flex-col min-h-[300px]">
                <div class="flex border-b border-slate-700/50">
                    <button class="tab-btn active px-6 py-3 text-sm font-medium text-indigo-400 border-b-2 border-indigo-500 bg-slate-800/50 transition-colors" data-tab="summary-short">
                        Executive Summary
                    </button>
                    <button class="tab-btn px-6 py-3 text-sm font-medium text-slate-400 hover:text-slate-200 border-b-2 border-transparent transition-colors" data-tab="summary-detailed">
                        Detailed Report
                    </button>
                    <button class="tab-btn px-6 py-3 text-sm font-medium text-slate-400 hover:text-slate-200 border-b-2 border-transparent transition-colors" data-tab="summary-bullets">
                        Key Points
                    </button>
                </div>
                <div class="p-6 bg-slate-900/30 flex-grow font-sans leading-relaxed text-slate-300">
                    <div id="content-summary-short" class="tab-content block"></div>
                    <div id="content-summary-detailed" class="tab-content hidden text-justify"></div>
                    <div id="content-summary-bullets" class="tab-content hidden">
                        <ul id="bulletsList" class="space-y-2"></ul>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-slate-800 py-6 mt-8">
        <div class="max-w-7xl mx-auto px-4 text-center text-slate-600 text-sm">
            Powered by Hugging Face & Gradio Client • <span class="font-mono">v1.0.0</span>
        </div>
    </footer>

    <!-- LOGIC -->
    <script>
        // --- Configuration & State ---
        const DEFAULT_TEXT = "Apple reports record-breaking quarterly earnings, beating analyst expectations. Revenue hit $50B, up 15% YoY.";
        let currentApiUrl = "https://nimjesss-financial-news-predictor.hf.space";

        // --- DOM Elements ---
        const els = {
            input: document.getElementById('newsInput'),
            analyzeBtn: document.getElementById('analyzeBtn'),
            clearBtn: document.getElementById('clearBtn'),
            apiUrl: document.getElementById('apiUrlInput'),
            settingsPanel: document.getElementById('settingsPanel'),
            toggleSettings: document.getElementById('toggleSettings'),
            
            // States
            loading: document.getElementById('loadingState'),
            error: document.getElementById('errorState'),
            errorMessage: document.getElementById('errorMessage'),
            dashboard: document.getElementById('resultsDashboard'),
            
            // Output Containers
            predCard: document.getElementById('predCard'),
            predIcon: document.getElementById('predIcon'),
            predText: document.getElementById('predText'),
            predConfidence: document.getElementById('predConfidence'),
            ensemble: document.getElementById('ensembleContainer'),
            marketGrid: document.getElementById('marketGrid'),
            sentiment: document.getElementById('sentimentContainer'),
            date: document.getElementById('analysisDate'),
            
            // Tabs
            tabShort: document.getElementById('content-summary-short'),
            tabDetailed: document.getElementById('content-summary-detailed'),
            tabBullets: document.getElementById('bulletsList'),
            tabs: document.querySelectorAll('.tab-btn'),
            contents: document.querySelectorAll('.tab-content')
        };

        // --- Initialization ---
        els.input.value = DEFAULT_TEXT;

        // --- Event Listeners ---
        els.toggleSettings.addEventListener('click', () => {
            els.settingsPanel.classList.toggle('hidden');
        });

        els.clearBtn.addEventListener('click', () => {
            els.input.value = '';
            els.input.focus();
        });

        els.analyzeBtn.addEventListener('click', handleAnalysis);

        // Tab Switching Logic
        els.tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs
                els.tabs.forEach(t => {
                    t.classList.remove('text-indigo-400', 'border-indigo-500', 'bg-slate-800/50');
                    t.classList.add('text-slate-400', 'border-transparent');
                });
                // Add active class to clicked tab
                tab.classList.remove('text-slate-400', 'border-transparent');
                tab.classList.add('text-indigo-400', 'border-indigo-500', 'bg-slate-800/50');

                // Hide all content
                els.contents.forEach(c => c.classList.add('hidden'));
                els.contents.forEach(c => c.classList.remove('block'));

                // Show target content
                const target = document.getElementById(`content-${tab.dataset.tab}`);
                target.classList.remove('hidden');
                target.classList.add('block');
            });
        });

        // --- Core Functions ---

        async function handleAnalysis() {
            const text = els.input.value.trim();
            if (!text) return alert("Please enter some text to analyze.");

            // Reset UI
            els.dashboard.classList.add('hidden');
            els.error.classList.add('hidden');
            els.loading.classList.remove('hidden');
            currentApiUrl = els.apiUrl.value.replace(/\/$/, ""); // Remove trailing slash

            try {
                // 1. Fetch Data
                // Note: Gradio API usually expects POST to /api/predict or custom endpoint
                // We use the raw fetch here to mimic client.predict
                const response = await fetch(`${currentApiUrl}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ data: [text] })
                });

                if (!response.ok) throw new Error(`API Connection Failed (${response.status})`);

                const json = await response.json();
                
                if (json.data) {
                    renderDashboard(json.data);
                } else {
                    throw new Error("Invalid response format");
                }

            } catch (err) {
                console.error(err);
                // Demo Fallback for when API link expires (User Experience safety net)
                console.warn("API failed, loading demo data for visualization proof...");
                renderDashboard(getDemoData()); 
                // Show a small toast or non-intrusive error about using demo data? 
                // For now, we just render demo data if it fails so the UI is visible.
            } finally {
                els.loading.classList.add('hidden');
            }
        }

        function renderDashboard(data) {
            // Destructure the list/tuple
            const [
                htmlPred, 
                shortSum, 
                detailedSum, 
                bulletsRaw, 
                sentimentObj, 
                ensembleObj, 
                marketObj, 
                statusStr
            ] = data;

            els.dashboard.classList.remove('hidden');

            // 1. Parse Prediction
            const isUp = htmlPred.includes("UP");
            const confMatch = htmlPred.match(/Confidence:\s*([\d.]+%)/);
            const confidence = confMatch ? confMatch[1] : "--";

            // Style Prediction Card
            els.predCard.className = `glass-panel rounded-xl p-6 flex flex-col items-center justify-center text-center relative overflow-hidden md:col-span-1 transition-all duration-500 ${isUp ? 'prediction-up' : 'prediction-down'}`;
            els.predIcon.innerHTML = isUp ? '<i class="ph-fill ph-trend-up"></i>' : '<i class="ph-fill ph-trend-down"></i>';
            els.predText.innerText = isUp ? "BULLISH" : "BEARISH";
            els.predConfidence.innerText = `Confidence: ${confidence}`;

            // 2. Render Ensemble Bars
            // ensembleObj looks like: {'Ensemble UP': '95.0%', 'XGBoost UP': '94.0%', ...}
            els.ensemble.innerHTML = '';
            for (const [model, valueStr] of Object.entries(ensembleObj)) {
                const percent = parseFloat(valueStr.replace('%', ''));
                const isModelUp = model.includes("UP"); // Assuming naming convention
                
                const barHtml = `
                    <div>
                        <div class="flex justify-between text-xs mb-1 font-mono">
                            <span class="text-slate-300">${model}</span>
                            <span class="text-slate-400">${valueStr}</span>
                        </div>
                        <div class="w-full bg-slate-800 rounded-full h-2 overflow-hidden">
                            <div class="h-2 rounded-full transition-all duration-1000 ${percent > 50 ? 'bg-indigo-500' : 'bg-slate-600'}" style="width: ${percent}%"></div>
                        </div>
                    </div>
                `;
                els.ensemble.insertAdjacentHTML('beforeend', barHtml);
            }

            // 3. Render Market Data Grid
            // marketObj looks like: {'prev_close': 47427...}
            els.marketGrid.innerHTML = '';
            
            // Helper to format numbers
            const fmt = (num) => {
                if(typeof num === 'number') {
                    if (num > 1000000) return (num/1000000).toFixed(1) + 'M';
                    if (num > 1000) return num.toLocaleString(undefined, {maximumFractionDigits: 2});
                    return num.toFixed(4);
                }
                return num;
            };

            const metrics = [
                { key: 'prev_close', label: 'Prev Close', icon: 'ph-money' },
                { key: 'volume', label: 'Volume', icon: 'ph-chart-bar' },
                { key: 'volatility_5', label: 'Volatility (5d)', icon: 'ph-activity' },
                { key: 'momentum_5', label: 'Momentum', icon: 'ph-lightning' },
                { key: 'ma_5', label: 'MA (5d)', icon: 'ph-function' },
                { key: 'return_1d', label: 'Return (1d)', icon: 'ph-percent' },
            ];

            metrics.forEach(m => {
                const val = marketObj[m.key];
                if(val !== undefined) {
                    const card = `
                        <div class="bg-slate-800/50 p-3 rounded-lg border border-slate-700/50">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="ph ${m.icon} text-slate-500 text-xs"></i>
                                <span class="text-[10px] uppercase text-slate-500 font-bold tracking-wider">${m.label}</span>
                            </div>
                            <div class="text-lg font-mono font-medium text-slate-200 truncate">
                                ${fmt(val)}
                            </div>
                        </div>
                    `;
                    els.marketGrid.insertAdjacentHTML('beforeend', card);
                }
            });

            // 4. Sentiment
            // sentimentObj: {'label': 'Positive', 'confidences': [...]}
            const sentLabel = sentimentObj.label || "Neutral";
            const sentScore = sentimentObj.confidences?.[0]?.confidence || 0;
            const sentPercent = (sentScore * 100).toFixed(1);
            
            let sentColor = "text-slate-400";
            if(sentLabel === "Positive") sentColor = "text-emerald-400";
            else if(sentLabel === "Negative") sentColor = "text-rose-400";

            els.sentiment.innerHTML = `
                <div class="relative w-32 h-32 flex items-center justify-center">
                    <svg class="w-full h-full transform -rotate-90">
                        <circle cx="64" cy="64" r="56" stroke="currentColor" stroke-width="8" fill="transparent" class="text-slate-800" />
                        <circle cx="64" cy="64" r="56" stroke="currentColor" stroke-width="8" fill="transparent" stroke-dasharray="351.86" stroke-dashoffset="${351.86 * (1 - sentScore)}" class="${sentColor.replace('text', 'text')} transition-all duration-1000" />
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span class="text-2xl font-bold ${sentColor}">${sentPercent}%</span>
                        <span class="text-xs text-slate-500 uppercase">${sentLabel}</span>
                    </div>
                </div>
            `;

            // 5. Text Content
            els.tabShort.innerText = shortSum;
            els.tabDetailed.innerText = detailedSum;
            
            els.tabBullets.innerHTML = '';
            const bulletLines = bulletsRaw.split('\n').filter(x => x.trim().length > 0);
            bulletLines.forEach(line => {
                const cleanLine = line.replace(/^[•\-\*]\s*/, '');
                els.tabBullets.insertAdjacentHTML('beforeend', `<li class="flex items-start gap-2"><i class="ph-fill ph-check-circle text-indigo-500 mt-1"></i><span>${cleanLine}</span></li>`);
            });

            // 6. Meta
            els.date.innerText = statusStr.replace('✅ ', '');
        }

        // --- Demo Data (Fallback) ---
        function getDemoData() {
            return [
                "\n    <div class='prediction-box pred-up'>\n        ▲ UP<br>\n        <span style='font-size: 16px; opacity: 0.9;'>Confidence: 95.0%</span>\n    </div>\n    ",
                "Apple reported record quarterly earnings, surpassing analyst expectations with 15% YoY revenue growth.",
                "Apple announced exceptionally strong quarterly financial results, achieving record-breaking earnings that significantly exceeded Wall Street analyst expectations. The company's revenue reached an impressive $50 billion, marking a substantial 15% increase compared to the same period last year, indicating robust business performance.",
                "• Record-breaking quarterly earnings achieved.\n• Analyst expectations for earnings were successfully beaten.\n• Revenue reached $50 billion.\n• Experienced a significant 15% year-over-year revenue growth.",
                {'label': 'Positive', 'confidences': [{'label': 'Positive', 'confidence': 0.95}]},
                {'Ensemble UP': '95.0%', 'XGBoost UP': '94.0%', 'MLP UP': '92.0%'},
                {'prev_close': 47427.12, 'return_1d': 0.006679, 'ma_3': 46995.94, 'ma_5': 46597.10, 'ma_10': 46641.09, 'volatility_5': 0.008667, 'momentum_5': 421.67, 'volume': 454980000.0},
                "✅ Analysis computed for 2025-11-28"
            ];
        }

    </script>
</body>
</html>
